# CCF 2025 HIP 编程竞赛 设计文档

## 概述

本项目针对CCF 2025 HIP编程竞赛实现了三道GPU加速算法题目：前缀和、Softmax函数计算和全点对最短路径（APSP）。所有实现均基于AMD HIP平台，针对AMD GPU特性进行了优化。

---

## 题目1：前缀和 (Prefix Sum)

### 设计思路
采用分层并行前缀和算法，充分利用AMD GPU的Wavefront特性：
- **Warp级扫描**：利用AMD GPU 64线程wavefront进行高效的shuffle操作
- **块级扫描**：使用共享内存进行块内前缀和计算，采用经典的up-sweep和down-sweep模式
- **多块协调**：对于大规模数据，实现多级扫描策略

### 关键优化
- 针对AMD GPU warp size=64进行优化（区别于NVIDIA的32）
- 使用`__shfl_up`指令实现高效的warp内通信
- 采用分块策略减少全局内存访问，提高cache利用率
- 动态选择单块或多块算法，根据数据规模自适应

### 算法复杂度
- 时间复杂度：O(N)，工作效率O(N/P)
- 空间复杂度：O(N)

---

## 题目2：Softmax 函数计算

### 设计思路
实现数值稳定的softmax算法，避免指数运算的上溢/下溢问题：
1. **最大值计算**：并行reduction找到输入向量的最大值m
2. **稳定化指数**：计算exp(xi - m)避免溢出
3. **求和归一化**：计算分母sum并完成最终的除法运算

### 关键优化
- **单遍融合kernel**：将三个阶段合并为一个kernel，减少内存访问
- **双精度累加**：使用double类型进行求和以提高数值精度
- **向量化访问**：充分利用GPU的向量化内存访问能力
- **共享内存优化**：高效使用shared memory进行块内reduction

### 数值稳定性
严格按照数值稳定公式：yi = exp(xi - max) / Σexp(xj - max)，确保计算结果的准确性。

---

## 题目3：全点对最短路径 (APSP)

### 设计思路
采用GPU优化的Floyd-Warshall算法：
- **块分治策略**：将N×N矩阵分解为32×32的块，利用GPU的块并行特性
- **三阶段计算**：
  1. 对角块更新：计算k-th轮的pivot块
  2. 边界块更新：更新与pivot块同行/同列的块
  3. 内部块更新：更新其余所有块
- **访存优化**：利用共享内存缓存频繁访问的数据块

### 关键优化
- **饱和算术**：实现溢出检测和处理，避免整数溢出导致的错误结果
- **内存合并访问**：确保全局内存访问模式的合并，最大化内存带宽
- **块大小调优**：选择32×32块大小平衡并行度和共享内存使用
- **边界处理**：优雅处理非块大小整数倍的图规模

### 算法复杂度
- 时间复杂度：O(N³/P)，其中P为并行处理器数
- 空间复杂度：O(N²)

---

## 通用优化策略

### 内存层次优化
- **全局内存**：使用合并访问模式，减少内存延迟
- **共享内存**：缓存频繁访问的数据，减少全局内存压力
- **寄存器优化**：最大化寄存器利用率，减少spill

### 并行模式
- **数据并行**：将计算任务分布到大量GPU线程
- **任务并行**：不同块处理不同的数据子集
- **流水线优化**：重叠计算和内存传输

### AMD GPU特性适配
- **Wavefront优化**：针对64线程wavefront设计算法
- **GCN/RDNA架构**：充分利用AMD GPU的计算单元布局
- **HIP运行时**：使用HIP API实现跨平台兼容性

---

## 性能目标

基于竞赛评分标准，三道题目均以执行时间性能为核心评价指标。

通过深度优化的GPU并行算法和AMD硬件特性适配，实现相比CPU串行版本数十倍的性能提升。
